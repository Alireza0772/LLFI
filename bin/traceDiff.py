#!/usr/bin/python

#traceDiff.py
#	Author: Sam Coulter
#	This python script is part of the greater LLFI system.
#	This script will examine two tracing output files generated by running a program after
#	the LLFI traceInst pass has been performed.

import sys
import subprocess

def traceDiff(argv):
	if (len(argv) != 3):
		print "Uh Oh, something broke! argv!=3"
		exit(1)
	diffProcess = subprocess.Popen(["diff",argv[1],argv[2]], stdout=subprocess.PIPE)
	(diffOutput,diffErr) = diffProcess.communicate()
	if (diffErr):
		print "diff encountered an error, exiting traceDiff"
		print diffErr
		exit(1)
	else:
		print diffOutput

	lines = diffOutput.split("\n")
	blocks = []
	block = []
	for line in lines:
		if len(line) == 0:
			continue
		if line[0] in ['<','>','-']:
			block.append(line)
			continue
		print "found a block header"
		print line
		blocks.append(block)
		block = []

	blocks.append(block)
	del blocks[0]

	#TODO:
	#	Add the block header information to each block, strip the diff </>/--- symbols
	#	from the blocks, extract the necessary information from the blocks.
	#	Should we OOP this? I dont think its necessary!
	
	print blocks






if (__name__ == "__main__"):
	traceDiff(sys.argv)